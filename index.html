<!DOCTYPE html>
<html>
  <head>
    <title>Select a pset</title>
    <link href="styles/select.css" rel="stylesheet" type="text/css">
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script>
      var psets = 
        [
          {
            name: "Problem Set 3",
            problems: [
              { name: "1: Bacon ipsum", charSet: "yd", type: "dfa" },
              { name: "2: Dolor amet", charSet: "yd", type: "dfa" },
              { name: "3: Flank meatloaf", charSet: "yd", type: "nfa" }
            ]
          },
          {
            name: "Problem Set 4",
              problems: [
              { name: "1: Short loin", charSet: "abc", type: "dfa" },
              { name: "2: T-bone alcatra", charSet: "abc", type: "dfa" },
              { name: "3: Filet mignon", charSet: "abc", type: "dfa" },
              { name: "4: Beef leberkas", charSet: "01", type: "nfa" },
              { name: "5: Picanha ham", charSet: "01", type: "nfa" },
              { name: "6: Pig shoulder", charSet: "01", type: "nfa" }
            ]
          },
          {
            name: "Problem Set 5",
              problems: [
              { name: "3: Chuck shank", charSet: "0123", type: "turing" },
              { name: "4: Chicken boudin", charSet: "0123", type: "turing" },
              { name: "5: Corned beef", charSet: "0123", type: "turing" }
            ]
          }
        ];
        
      function setup () {
        var psetSelect = d3.select (".pset").selectAll ("option").data (psets);
        psetSelect.enter ()
          .append ("option")
          .attr ("value", function (pset, i) { return i; })
          .each (function (pset, i) { this.innerHTML = pset.name; });
        d3.select ('.pset')
          .on ("change", changeNumbers)
          .node ().selectedIndex = 0;
        changeNumbers ();
      }
        
      function changeNumbers () {
        console.log ("fired");
        var psetNum = d3.select ('.pset').node ().selectedIndex;
        var problemSelect = d3.select (".problem").selectAll ("li").data (psets[psetNum].problems);
        
        problemSelect.enter ()
          .append ("li")
          .on ("click", function (junk, i) {
            createPset (i);
          });
          
        problemSelect.each (function (problem) { this.innerHTML = problem.name; });
          
        problemSelect.exit ().remove ();
      }
      
      function createPset (problemNum) {
        var psetNum = d3.select ('.pset').node ().selectedIndex;
        var charSet = psets[psetNum].problems[problemNum].charSet;
        var type = psets[psetNum].problems[problemNum].type;
        var url = window.location.href;
        var loc = url.lastIndexOf ("/") + 1;
        if (loc <= 8) {
          url += "/";
        } else {
          url = url.substring (0, loc);
        }
        window.location = url + "tm.html?type=" + type +
                          "&charset=" + charSet +
                          "&pset=" + psetNum +
                          "&problem=" + problemNum;
      }
      
      function createOther () {
        var type = d3.select ('.type').node ().selected;
        var charSet = d3.select ('.language').node ().value;
        var url = window.location.href;
        var loc = url.lastIndexOf ("/") + 1;
        if (loc <= 8) {
          url += "/";
        } else {
          url = url.substring (0, loc);
        }
        window.location = url + "tm.html?type=" + type +
                          "&charset=" + charSet;
      }
    </script>
  </head>
  <body onload="setup ()">
    <div class="header">
      <h2>CS 103</h2>
      <h1>Automata Designer</h1>
      <h3>DFAs + NFAs + TURING MACHINES</h3>
    </div>
    <div class="select-problems">
      <div class="select-pset">
        I'm designing for
        <select class="pset"></select>
      </div>
      <ul class="problem"></ul>
    </div>
  </body>
</html>

<!DOCTYPE html>
<html>
  <head>
    <title>Select a pset</title>
    <link href="styles/select.css" rel="stylesheet" type="text/css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
    <script src="psets.js"></script>
    <script src="server/server.js"></script>
    <script src="server/mock.js"></script>
    <script>

      function setup () {
        var psetSelect = d3.select (".pset").selectAll ("option").data (psets);
        psetSelect.enter ()
          .append ("option")
          .attr ("value", function (pset, i) { return i; })
          .text (function (pset) { return pset.name; });
        d3.select ('.pset')
          .on ("change", changeNumbers)
          .node ().selectedIndex = 0;
        changeNumbers ();
        gServer.listSaved (setupSaved);
      }

      function setupSaved (names) {
        var savedSelect = d3.select (".saved").selectAll ("li").data (names);

        savedSelect.enter ()
          .append ("li")
          .on ("click", function (nameObj, i) {
            loadSaved (nameObj.name);
          });

        savedSelect.text (function (nameObj) { return nameObj.name; });

        savedSelect.exit ().remove ();

        if (names.length == 0) {
          d3.select (".saved")
            .append ("li")
            .classed ("load-nothing", true)
            .html ("<p class='modal-description'>Nothing's been saved yet</p>");
        }
      }

      function loadSaved (name) {
        var url = window.location.href;
        var loc = url.lastIndexOf ("/") + 1;
        if (loc <= 8) {
          url += "/";
        } else {
          url = url.substring (0, loc);
        }
        window.location = url + "tm.html?saved=" + name;
      }

      function changeNumbers () {
        var psetNum = d3.select ('.pset').node ().selectedIndex;
        var problemSelect = d3.select (".problem").selectAll ("li").data (psets[psetNum].problems);

        problemSelect.enter ()
          .append ("li")
          .on ("click", function (junk, i) {
            createPset (i);
          });

        problemSelect.text (function (problem) { return problem.name; });

        problemSelect.exit ().remove ();
      }

      function createPset (problemNum) {
        var psetNum = d3.select ('.pset').node ().selectedIndex;
        var charSet = psets[psetNum].problems[problemNum].charSet;
        var type = psets[psetNum].problems[problemNum].type;
        var url = window.location.href;
        var loc = url.lastIndexOf ("/") + 1;
        if (loc <= 8) {
          url += "/";
        } else {
          url = url.substring (0, loc);
        }
        window.location = url + "tm.html?type=" + type +
                          "&charset=" + charSet +
                          "&pset=" + psetNum +
                          "&problem=" + problemNum;
      }

      function createOther () {
        var type = d3.select ('.dfa-radio').node ().checked ? "dfa" : "nfa";
        var charSet = d3.select ('.language').node ().value;
        var url = window.location.href;
        var loc = url.lastIndexOf ("/") + 1;
        if (loc <= 8) {
          url += "/";
        } else {
          url = url.substring (0, loc);
        }
        window.location = url + "tm.html?type=" + type +
                          "&charset=" + charSet;
      }
    </script>
  </head>
  <body onload="setup ()">
    <div class="header">
      <h2>CS 103</h2>
      <h1>Automata Designer</h1>
      <h3>DFAs + NFAs + TURING MACHINES</h3>
    </div>
    <div class="select-problems">
      <div class="select-pset">
        I'm designing for
        <select class="pset"></select>
      </div>
      <ul class="problem"></ul>
      <div class="custom standalone">
        I'm doing my own thing.
        <div class="custom-field">
          <form>
            <label><input type="radio" name="type" checked="checked" class="dfa-radio">DFA</label>
            <label><input type="radio" name="type">NFA</label>
            <input type="text" placeholder="Alphabet" class="language"></input>
            <button type="button" onclick="createOther()">Go</button>
          </form>
        </div>
      </div>
      <div class="custom">
        I'm loading something I've saved.
      </div>
      <ul class="saved"></ul>
    </div>
  </body>
</html>
